!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("vue"),require("js-cookie")):"function"==typeof define&&define.amd?define(["exports","vue","js-cookie"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).EASIUtils={},e.Vue,e.Cookies)}(this,(function(e,t,n){"use strict";function o(e){if(e&&e.__esModule)return e;var t={__proto__:null,[Symbol.toStringTag]:"Module"};return e&&Object.keys(e).forEach((function(n){if("default"!==n){var o=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,o.get?o:{enumerable:!0,get:function(){return e[n]}})}})),t.default=e,Object.freeze(t)}var i=o(n);const r=class{constructor(e,t){this.options=Object.assign({},r.defaultOptions,t),this.name=e,this.version=this.options.version,this.db=void 0,this.initComplete=!1,this.versionChanged=null,this.initPromise=this.init();for(const n of this.options.store){const{storeName:e}=n;this[`$${e}`]={add:(t,n)=>this.add(e,t,n),put:(t,n)=>this.put(e,t,n),getAll:(t,n,o)=>this.getAll(e,t,n,o),get:(t,n)=>this.get(e,t,n),getAllKeys:(t,n)=>this.getAllKeys(e,t,n),count:t=>this.count(e,t),delete:t=>this.delete(e,t),deleteIndex:t=>this.deleteIndex(e,t),elasticSearch:(t,n)=>this.elasticSearch(e,t,n),index:t=>this.index(e,t),clear:()=>this.clear(e)}}}async init(){return new Promise(((e,t)=>{if(this.initComplete)return e(this.db);const n=window.indexedDB.open(this.name,this.version);n.onerror=e=>{t(e)},n.onsuccess=async()=>{this.db=n.result,this.initComplete=!0,this.db.onversionchange=()=>{window.location.reload()},this.versionChanged&&this.options.upgradeCallBack&&await this.options.upgradeCallBack(this,this.versionChanged),e(this.db)},n.onupgradeneeded=async e=>{this.versionChanged=e,await this._upgrade(e,n)}}))}async _upgrade(e,t){this.db=e.target.result;for(const n of this.options.store)await this.createStore(n,t);return this.db}async createStore(e,t){const{storeName:n,options:o,indexOptions:i}=e;let s;return this.db.objectStoreNames.contains(n)?t.transaction.objectStore(n):(s=this.db.createObjectStore(n,Object.assign({},r.defaultStoreOptions,o)),console.log(s),i&&i.forEach((e=>{s.createIndex(e.name,e.key,{unique:e.unique,multiEntry:!!e.multiEntry})})),s)}async add(e,t,n){return this.initComplete||await this.initPromise,new Promise(((o,i)=>{const r=this.db.transaction([e],"readwrite").objectStore(e).add(t,n);r.onsuccess=function(e){o(e)},r.onerror=function(e){i(e)}}))}async delete(e,t){return this.initComplete||await this.initPromise,new Promise(((n,o)=>{const i=this.db.transaction([e],"readwrite").objectStore(e).delete(t);i.onsuccess=function(e){n(e)},i.onerror=function(e){o(e)}}))}async deleteIndex(e,t){return this.initComplete||await this.initPromise,this.db.transaction([e],"readwrite").objectStore(e).deleteIndex(t),"delete success"}async clear(e){return this.initComplete||await this.initPromise,new Promise(((t,n)=>{const o=this.db.transaction([e],"readwrite").objectStore(e).clear();o.onsuccess=e=>{t(e)},o.onerror=e=>{n(e)}}))}async put(e,t,n){return this.initComplete||await this.initPromise,new Promise(((o,i)=>{const r=this.db.transaction([e],"readwrite").objectStore(e).put(t,n);r.onsuccess=function(){o(t)},r.onerror=function(e){i(e)}}))}async get(e,t,n){return this.initComplete||await this.initPromise,new Promise(((o,i)=>{const r=this.db.transaction([e],"readonly").objectStore(e);let s;if(n){const e=r.index(n);s=e.get(t)}else s=r.get(t);s.onerror=function(e){i(e)},s.onsuccess=function(){s.result?o(s.result):o(null)}}))}async getAllKeys(e,t,n){return this.initComplete||await this.initPromise,new Promise(((o,i)=>{const r=this.db.transaction([e],"readonly").objectStore(e).getAllKeys(t,n);r.onsuccess=function(){o(r.result)},r.onerror=function(e){i(e)}}))}async getAll(e,t,n,o){return this.initComplete||await this.initPromise,new Promise(((i,r)=>{let s=this.db.transaction(e).objectStore(e);const a=t?s.index(t):s,c=null!=o?a.getAll(n,o):a.getAll(n);c.onsuccess=function(){i(c.result)},c.onerror=function(e){r(e)}}))}async elasticSearch(e,t,n){return this.initComplete||await this.initPromise,new Promise(((o,i)=>{const r=this.db.transaction(e).objectStore(e),s=[],a=r.openCursor();a.onsuccess=e=>{const i=e.target.result;i?(Array.isArray(n)?n.some((e=>this._compareType(i.value,t,e)))&&s.push(i.value):this._compareType(i.value,t,n)&&s.push(i.value),i.continue()):o(s)},a.onerror=e=>{i(e)}}))}_compareType(e,t,n){const o=n?e[n]:e;let i=!1;switch(typeof o){case"boolean":i="boolean"==typeof t&&o===t;break;case"number":case"bigint":i="number"==typeof t&&o===t;break;case"string":i="string"==typeof t&&o.indexOf(t)>-1||t instanceof RegExp&&t.test(o);break;default:Array.isArray(o)&&(i=t instanceof RegExp?o.some((e=>t.test(e))):o.includes(t))}return i}async index(e,t){return this.initComplete||await this.initPromise,this.db.transaction(e).objectStore(e).index(t)}async count(e,t){return this.initComplete||await this.initPromise,new Promise(((n,o)=>{const i=this.db.transaction(e).objectStore(e).count(t);i.onsuccess=function(){n(i.result)},i.onerror=function(e){o(e)}}))}};let s=r;s.defaultOptions={version:1,store:[]},s.defaultStoreOptions={autoIncrement:!0};const a=Symbol();var c={install:(e,t)=>{if(!t)throw new Error("请设置indexDB参数");const{databaseName:n,options:o}=t,i=new s(n,o);e.config.globalProperties.$db=i,e.provide(a,i)}};function u(e,t,n=0){n&&(n=Date.now()+n);const o=JSON.stringify({value:t,expires:n});this.setItem(e,o)}function l(e){const t=this.getItem(e);if(!t)return null;const{value:n,expires:o}=JSON.parse(t);return o&&Date.now()>=o?(this.removeItem(e),null):n}e.EASIIndexDB=s,e.clearLocal=function(){localStorage.clear()},e.clearSession=function(){sessionStorage.clear()},e.compareUserAgent=function(e=[],t=navigator.userAgent.toLowerCase()){return e.some((e=>t.indexOf(e)>-1))},e.compareVersion=function(e,t=navigator.userAgent.toLowerCase()){try{let n=t.match(/^(easicustomer|easimalaysia)(.+?)(\s|\()/)[2].replace(/\s|\//g,"").split("."),o=e.split("."),i=n.length>o.length?n.length:o.length;for(let e=0;e<i;e++){if(Number(o[e]||0)<Number(n[e]||0))return!0;if(Number(o[e]||0)>Number(n[e]||0))return!1}return!0}catch(n){return!1}},e.copy=function(e,t=document.querySelector("body")){if(!document.queryCommandSupported("copy"))return!1;const n=document.createElement("textarea");n.value=e,t.appendChild(n),n.select(),n.setSelectionRange(0,e.length);const o=document.execCommand("copy");return n.remove(),o},e.createWorker=function(e,t,n){return new Promise(((o,i)=>{if(!window.Worker)return n&&n(t);{const n=new Blob(["("+e.toString()+")()"]),r=window.URL.createObjectURL(n),s=new Worker(r);s.postMessage(t),s.onmessage=({data:e})=>{s.terminate(),o(e)},s.onerror=e=>{s.terminate(),i(e.message)},s.onmessageerror=e=>{s.terminate(),i(e)}}}))},e.debounced=function(e,t=200,n=!1){let o;return(...i)=>{if(n)return e.apply(this,i),void(n=!1);clearTimeout(o),o=setTimeout((()=>{e.apply(this,i)}),t)}},e.getCookie=function(e){return i.get(e)},e.getLocal=function(e){return l.call(localStorage,e)},e.getSession=function(e){return l.call(sessionStorage,e)},e.indexDBPlugin=c,e.isMobile=function(){return!!window.navigator.userAgent.match(/(Android|iPhone|SymbianOS|Windows Phone|iPad|iPod)/i)},e.loadScript=function(e,t){return new Promise(((n,o)=>{if(document.querySelector(`#${t}`))return n("");const i=document.createElement("script");i.type="text/javascript",i.src=e,t&&(i.id=t),document.getElementsByTagName("head")[0].appendChild(i),i.onload=function(){n("")},i.onerror=function(){o("引入失败")}}))},e.openAppView=function(e,t="au.com.easi.customer"){window.location.href=`${t}://${e}`},e.openAppWeb=function({scheme:e="au.com.easi.courier",title:t,url:n,show:o}){window.location.href=`${e}://web/help?text=${t}&url=${encodeURIComponent(n)}&show=${o}`},e.removeCookie=function(e){return i.remove(e)},e.removeLocal=function(e){localStorage.removeItem(e)},e.removeSession=function(e){sessionStorage.removeItem(e)},e.setCookie=function(e,t,n){n&&(n/=864e5),n?i.set(e,t,{expires:n}):i.set(e,t)},e.setLocal=function(e,t,n=0){u.call(localStorage,e,t,n)},e.setSession=function(e,t,n=0){u.call(sessionStorage,e,t,n)},e.useDB=function(){const e=t.inject(a);if(!e)throw new Error("未发现indexdb实例");return e},Object.defineProperty(e,"__esModule",{value:!0}),e[Symbol.toStringTag]="Module"}));
